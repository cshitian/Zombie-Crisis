# 开发日志 (Changelog)

## [1.3.0] - 2025-12-26

### 音效系统深度增强 (Advanced Audio System)

- **全方位战场音效**:
  - **武器声效补全**: 修复了手枪和狙击步枪的静音问题，新增散弹枪、火箭筒和网枪的专属射击音效。
  - **平民语音互动**: 引入了基于性别和年龄的平民语音系统。平民现在会根据处境发出恐惧（Fear）、尖叫（Scream）、欢呼（Clap）或紧急求助（Urge/Shout）。
  - **感染者生物音效**: 新增僵尸咆哮（Roar）和啃咬（Bite）音效，提升战场恐怖氛围。
- **智能音频优先级系统 (Audio Priority System)**:
  - 实现了“选中单位优先”逻辑。当前选中的实体或发生在其附近的事件音效将自动获得更高优先级，确保关键反馈不会被背景杂音淹没。
- **环境交互音效**: 实现了音效的地理空间感应，根据实体所在位置和邻近威胁动态触发相应的环境语音。

### UI 交互优化 (UI Interaction)

- **任务栏智能切换**: 修复了部署任务后的交互延迟。现在点击任意部署按钮（如空投、空袭）后，按钮进入倒计时的同时，任务面板会自动立即切换回“观察移动”状态，方便玩家无缝继续操控地图。

## [1.2.0] - 2025-12-26

### 建筑交互与战术系统 (Building Interaction & Tactics)

- **交互式建筑选择**: 地图上的建筑物现在支持点击选中，并伴有动态高亮和边框控制。
- **建筑战术识别面板 (Building Inspector)**:
  - **实时战术分析**: 根据建筑物的 OpenStreetMap 类别（住宅、商业、工业等）自动生成“战术优势 (Pros)”与“战术缺陷 (Cons)”。
  - **安全性预估**: 系统自动评估建筑物在僵尸危机下的防守安全等级（Low/Medium/High/Very High）。
  - **沉浸式描述**: 为不同类型的建筑提供独特的战术背景说明，增强代入感。
- **动态建筑加载**:
  - **随动渲染**: 解决了移动地图或缩放时建筑不更新的问题。现在移动地图后，新区域的建筑会自动加载并变为可点击状态。
  - **增量同步**: 采用增量加载与去重技术，确保已探索区域的建筑持续保留。
- **环境物理与反馈增强**:
  - **室内速度修正**: 进入不同类型的建筑会根据实体类型（僵尸/平民/专业人员）获得不同的移动速度修正。
  - **边界切换反馈**: 实体进入或离开建筑物时，会触发专属的心声（Thought）和心情气泡（Mood Bubbles），如“寻找掩护”、“进入危险区”等。
- **UI 体验精简**: 移除了建筑信息面板中的冗余技术元数据，专注于展示对生存决策有价值的战术信息。

## [1.1.1] - 2025-12-25

### 移动端适配与优化 (Mobile Adaptation)

- **响应式界面全面覆盖**: 针对手机浏览器进行了深度适配，确保所有核心功能在小屏幕上均可正常使用。
- **通讯频道 (Radio Log) 优化**:
  - 移除了移动端隐藏逻辑，现在通讯频道在手机端默认可见。
  - 智能定位：移动端通讯频道自动上移，避免与底部任务栏重叠。
  - 响应式初始尺寸：根据屏幕宽度自动调整通讯窗口的大小。
- **任务栏 (Toolbar) 布局改进**:
  - **动态缩放**: 任务按钮在移动端自动缩小，并针对极窄屏幕（如 iPhone SE）进行了精细化尺寸调整。
  - **美化与排版**: 优化了金额（$）徽章和图标在小尺寸按钮中的排布，解决了覆盖和重叠问题。
  - **边缘无损显示**: 修复了选中状态（Selected）下的缩放动画 and 发光外框被容器截断的视觉缺陷。
- **交互体验增强**:
  - **无损滚动**: 移除了任务栏多余的滚动条，同时保留横向滑动切换功能。
  - **精简文字**: 在移动端自动切换更精简的按钮文本（如“暂停”代替“模拟暂停”），提升界面整洁度。

## [1.1.0] - 2025-12-25

### 新增特性

- **高度动态的环境化对话系统**
  - **地理位置感知**: 深度整合 OpenStreetMap 数据，实时提取街道、地标、建筑名称和区域信息。
  - **基于 Gemini 2.0 的无线电通讯**: 升级至 `gemini-2.0-flash` 且采用 `v1` 稳定接口。无线电对话现由 AI 动态生成，能根据当前街道（如：Broadway）和地标构建逼真的战场报告。
  - **社交感应与心声系统增强**: 
    - **平民人格化**: 扩充了平民内心活动库，增加关于往事回忆、家庭思念及生存需求（饥饿、水、情报）的描写。
    - **动态反应**: 平民现在能感应周边 20 米内的实体——发现援军（士兵/医疗兵）时会表达希望，遭遇僵尸贴身时会产生极度恐慌反应。
    - **情境化位置融合**: 所有的内心活动依然会随机融合其当前的地理坐标信息（如：具体的街道名、附近的地标）。
- **交互与界面优化 (UI/UX)**
  - **个体随机冒泡图标 (Bubbling System)**: 场景个体上方新增随机出现的表情气泡，直观呈现其当前的心理动态或生存意愿，并配合柔和浮动动画增强生动感。
  - **个体追踪系统**: 在人物信息面板中新增了“镜头跟踪”切换按钮，允许玩家一键锁定并跟随特定幸存者或队员。
  - **通讯日志稳定性**: 将缓存提升至 200 条，配合多层级唯一 ID 和智能节流机制，彻底解决记录跳变问题。
  - **API 网络优化**: 针对 OpenStreetMap (Nominatim) 增加了 1.1 秒强制请求节流，避免访问频率过快导致的连接被拒。

### 调整与优化

- **环境配置**: 优化了 API Key 的校验逻辑，提供了 `.env.example` 模板并重写了 `README.md`。
- **默认地点**: 游戏主战场迁移至 **纽约时代广场 (NYC Times Square)**。

## [1.0.0] - 2025-12-25

### 新增特性

- **交互式实时通讯频道**
  - 在无线电日志中点击队员姓名可立即在地图上定位并选中该单位。
  - 实现“镜头跟随”模式：点击定位后地图会锁定并跟随队员移动，保持其在视野中心。
  - 智能自动滚动：仅当玩家位于底部时才自动滚动新消息，方便阅读历史记录。
  - 窗口缩放功能：支持拖动频道窗口边缘或右上角来调整窗口大小。
- **高级语音系统**
  - 武装平民加入：平民一旦获得空投武器即可接入无线电频道并发布状态。
  - 误伤警报：增加了指挥部对友军误伤（空袭、爆炸）的语音警报。
  - 角色间吐槽：特种队员会根据周围环境对武装平民的“非专业”表现进行语音抱怨。
- **视觉效果增强**
  - 优化了射击线和医疗线的渲染逻辑，解决了镜头移动时的视觉错位问题。

### 优化与修复

- **地图交互**：增加了鼠标拖拽自动退出镜头跟随的功能，实现操作无缝切换。
- **性能优化**：改进了主循环中的实体状态同步逻辑。
- **大气音效**：增加了队员在空闲时的随机自言自语，增强战场沉浸感。

---
*注：本项目持续开发中。*
