# 开发日志 (Changelog)

## [1.1.0] - 2025-12-25

### 新增特性

- **高度动态的环境化对话系统**
  - **地理位置感知**: 深度整合 OpenStreetMap 数据，实时提取街道、地标、建筑名称和区域信息。
  - **基于 Gemini 2.0 的无线电通讯**: 升级至 `gemini-2.0-flash` 且采用 `v1` 稳定接口。无线电对话现由 AI 动态生成，能根据当前街道（如：Broadway）和地标构建逼真的战场报告。
  - **社交感应与心声系统增强**: 
    - **平民人格化**: 扩充了平民内心活动库，增加关于往事回忆、家庭思念及生存需求（饥饿、水、情报）的描写。
    - **动态反应**: 平民现在能感应周边 20 米内的实体——发现援军（士兵/医疗兵）时会表达希望，遭遇僵尸贴身时会产生极度恐慌反应。
    - **情境化位置融合**: 所有的内心活动依然会随机融合其当前的地理坐标信息（如：具体的街道名、附近的地标）。
- **交互与界面优化 (UI/UX)**
  - **个体追踪系统**: 在人物信息面板中新增了“镜头跟踪”切换按钮，允许玩家一键锁定并跟随特定幸存者或队员。
  - **通讯日志稳定性**: 将缓存提升至 200 条，配合多层级唯一 ID 和智能节流机制，彻底解决记录跳变问题。
  - **API 网络优化**: 针对 OpenStreetMap (Nominatim) 增加了 1.1 秒强制请求节流，避免访问频率过快导致的连接被拒。

### 调整与优化

- **环境配置**: 优化了 API Key 的校验逻辑，提供了 `.env.example` 模板并重写了 `README.md`。
- **默认地点**: 游戏主战场迁移至 **纽约时代广场 (NYC Times Square)**。

## [1.0.0] - 2025-12-25

### 新增特性

- **交互式实时通讯频道**
  - 在无线电日志中点击队员姓名可立即在地图上定位并选中该单位。
  - 实现“镜头跟随”模式：点击定位后地图会锁定并跟随队员移动，保持其在视野中心。
  - 智能自动滚动：仅当玩家位于底部时才自动滚动新消息，方便阅读历史记录。
  - 窗口缩放功能：支持拖动频道窗口边缘或右上角来调整窗口大小。
- **高级语音系统**
  - 武装平民加入：平民一旦获得空投武器即可接入无线电频道并发布状态。
  - 误伤警报：增加了指挥部对友军误伤（空袭、爆炸）的语音警报。
  - 角色间吐槽：特种队员会根据周围环境对武装平民的“非专业”表现进行语音抱怨。
- **视觉效果增强**
  - 优化了射击线和医疗线的渲染逻辑，解决了镜头移动时的视觉错位问题。

### 优化与修复

- **地图交互**：增加了鼠标拖拽自动退出镜头跟随的功能，实现操作无缝切换。
- **性能优化**：改进了主循环中的实体状态同步逻辑。
- **大气音效**：增加了队员在空闲时的随机自言自语，增强战场沉浸感。

---
*注：本项目持续开发中。*
